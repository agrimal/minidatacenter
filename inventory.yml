all:
    hosts:
        localhost:
            # Network configuration of the host
            # This is Netplan syntax
            # See https://wiki.ubuntu.com/Netplan for more information
            network:
                ethernets:
                    eno1:
                        dhcp4: no
                        dhcp6: no
                    eno2:
                        dhcp4: no
                        dhcp6: no
                bridges:
                    br-ext:
                        addresses:
                        - 192.168.1.200/24
                        gateway4: 192.168.1.1
                        nameservers:
                            addresses:
                            - 192.168.1.201
                            - 192.168.1.1
                        interfaces:
                        - eno1
                        dhcp4: no
                        dhcp6: no
                    br-int:
                        addresses:
                        - 10.10.0.200/24
                        dhcp4: no
                        dhcp6: no
            # Change this to False if you don't want to run 'lxd init' each time
            # you run the playbook 
            lxd_init: False
            # LXD configuration
            # See https://github.com/lxc/lxd/blob/master/doc/preseed.md for more
            # information
            lxd_preseed:
                config:
                    core.https_address: 192.168.1.200:8443
                    core.trust_password: PASSWORD
                    images.auto_update_interval: 24
                    images.remote_cache_expiry: 2
                storage_pools:
                  - name: lxd
                    driver: zfs
                    config:
                        source: rpool/lxd
                profiles:
                  - name: default
                    devices:
                        root:
                            path: /
                            pool: lxd
                            type: disk
                            size: 10GB
                        ethint:
                            name: ethint
                            nictype: bridged
                            parent: br-int
                            type: nic
                        ethext:
                            name: ethext
                            nictype: bridged
                            parent: br-ext
                            type: nic
    vars:
        ansible_python_interpreter: '/usr/bin/env python3'
        ansible_ssh_common_args: '-o StrictHostKeyChecking=no'
        pipelining: True
        minidc_working_directory: '/opt/minidc_secrets'
        local_timezone: 'Europe/Paris'
    children:
        containers:
            vars:
                source_server: 'https://images.linuxcontainers.org'
                source_type: 'image'
                source_protocol: 'simplestreams'
                source_alias: 'ubuntu/bionic/amd64'
                source_mode: 'pull'
                lxd_profiles:
                - 'default'
                lxd_config:
                    limits.cpu: '2'
                    limits.memory: '2GB'
                    boot.autostart: 'true'
                ansible_connection: 'lxd'
            hosts:
                ubudns03:
                    network:
                        ethernets:
                            ethint:
                                dhcp4: false
                                dhcp6: false
                                addresses:
                                - 10.10.0.201/24
                            ethext:
                                dhcp4: false
                                dhcp6: false
                                addresses:
                                - 192.168.1.201/24
                                gateway4: 192.168.1.1
                                nameservers:
                                    addresses:
                                    - 127.0.0.1
                                    - 192.168.1.1
                ubudhcp03:
                    network:
                        ethernets:
                            ethint:
                                dhcp4: false
                                dhcp6: false
                                addresses:
                                - 10.10.0.202/24
                            ethext:
                                dhcp4: false
                                dhcp6: false
                                addresses:
                                - 192.168.1.202/24
                                gateway4: 192.168.1.1
                                nameservers:
                                    addresses:
                                    - 192.168.1.201
                                    - 192.168.1.1
                ubuca03:
                    network:
                        ethernets:
                            ethint:
                                dhcp4: false
                                dhcp6: false
                                addresses:
                                - 10.10.0.203/24
                            ethext:
                                dhcp4: false
                                dhcp6: false
                                addresses:
                                - 192.168.1.203/24
                                gateway4: 192.168.1.1
                                nameservers:
                                    addresses:
                                    - 192.168.1.201
                                    - 192.168.1.1
